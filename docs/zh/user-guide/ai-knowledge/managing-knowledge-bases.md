---
sidebar_position: 7
---

# 管理知识库

[English](../../../en/user-guide/ai-knowledge/managing-knowledge-bases.md) | 简体中文

> ⚠️ **实验性功能**：知识库功能目前正在积极开发中。功能和行为可能会在未来版本中更改。

## 概述

Wegent 中的知识库允许您存储文档，并让 AI 在对话中引用它们。本指南介绍如何有效地创建、管理和使用知识库。

## 知识库类型

Wegent 支持两种类型的知识库：

### 笔记本模式

- **使用场景**：交互式文档探索和问答
- **特点**：
  - 三栏布局，包含文档面板和聊天区域
  - 可直接在知识库内对话
  - 每个知识库最多 50 个文档
  - 适合专注的研究和文档分析

### 经典模式

- **使用场景**：在聊天中引用的大型文档库
- **特点**：
  - 仅文档列表（无内置聊天）
  - 无文档数量限制
  - 从聊天或代码对话中引用
  - 适合大型文档库

## 创建知识库

### 使用 RAG（推荐）

当您已配置检索器和 Embedding 模型时：

1. 导航到 **知识** → **文档知识**
2. 点击 **创建知识库** 或 **创建笔记本**
3. 填写：
   - **名称**：知识库的唯一标识符
   - **描述**：可选描述
   - **类型**：笔记本或知识库
4. 配置检索设置：
   - **检索引擎**：选择已配置的检索器（如 Elasticsearch）
   - **Embedding 模型**：选择用于生成向量的模型
   - **检索方式**：向量、关键词或混合
   - **Top K**：返回结果数量（1-10）
   - **Score 阈值**：最低相似度分数（0-1）
5. 点击 **创建**

### 不使用 RAG（探索模式）

当没有可用的检索器或 Embedding 模型时：

1. 导航到 **知识** → **文档知识**
2. 点击 **创建知识库** 或 **创建笔记本**
3. 填写基本信息（名称、描述、类型）
4. 检索设置将被禁用并显示警告
5. 点击 **创建**

> **注意**：在探索模式下，AI 使用 `kb_ls` 和 `kb_head` 工具而非语义搜索。详见[无 RAG 模式使用知识库](configuring-retrievers.md#无-rag-模式使用知识库)。

## 文档管理

### 上传文档

1. 打开您的知识库
2. 点击 **添加来源**
3. 选择来源类型：
   - **文件**：上传本地文件（MD、PDF、TXT、DOCX、代码文件）
   - **文本**：直接创建文本文档
   - **网页**：从 URL 导入

### 支持的格式

| 格式 | 描述 | 适用场景 |
|------|------|----------|
| `.md` | Markdown 文件 | 文档、笔记 |
| `.pdf` | PDF 文档 | 报告、论文 |
| `.txt` | 纯文本 | 简单文档 |
| `.docx` | Word 文档 | 格式化内容 |
| 代码文件 | `.py`、`.js`、`.ts` 等 | 代码文档 |

### 文档摘要

启用后，Wegent 可以为文档自动生成摘要：

1. 在知识库设置中启用 **自动生成摘要**
2. 选择摘要模型
3. 摘要有助于 AI 快速识别相关文档

### 文档状态

- **已启用**：文档处于活动状态且可搜索
- **已禁用**：文档已存储但不参与搜索
- **索引中**：文档正在进行 RAG 处理（如已配置）

## 知识库的 AI 工具

### knowledge_base_search（RAG 模式）

查找相关文档分块的语义搜索工具：

```text
输入：查询字符串
输出：带分数和来源的相关分块
```

**要求**：已配置检索器和 Embedding 模型

### kb_ls - 列出文档

列出知识库中的所有文档及元数据：

```text
输入：knowledge_base_id
输出：文档列表，包含：
  - ID、名称、文件扩展名
  - 文件大小
  - 简短摘要（如有）
  - 活动状态
```

**适用**：RAG 和无 RAG 模式

### kb_head - 读取文档内容

支持分页读取文档内容：

```text
输入：document_ids、offset（默认 0）、limit（默认 50KB）
输出：
  - 文档内容
  - 总长度
  - has_more 标志用于分页
```

**适用**：RAG 和无 RAG 模式

### Wegent 知识库技能（MCP）

如果您的智能体启用了内置的 `wegent-knowledge` 技能，它可以通过 MCP 以编程方式管理知识库与文档：

- `create_knowledge_base`：创建新的知识库（个人或群组命名空间）
- `list_knowledge_bases`：列出可访问的知识库
- `list_documents`：列出知识库内的文档
- `create_document`：上传文档（文本 / 文件 / 网页）
- `update_document`：更新文档内容（覆盖 / 追加）
- `delete_document`：从知识库删除文档

## 在对话中使用知识库

### 在聊天中

1. 开始新聊天或打开现有对话
2. 点击输入区域的知识库图标
3. 选择一个或多个知识库
4. AI 在回答时会搜索所选知识库

### 在笔记本模式中

1. 打开笔记本类型的知识库
2. 使用右侧的内置聊天面板
3. AI 自动引用笔记本中的所有文档

### 选择模式

| 模式 | 何时 | AI 行为 |
|------|------|---------|
| **严格** | 用户为当前消息选择 KB | 必须使用 KB，不能使用通用知识 |
| **宽松** | KB 从任务继承 | 可回退到通用知识 |

## 调用限制

知识库支持调用限制以管理 API 成本：

- **每次对话最大调用数**：允许的最大工具调用次数
- **检查前豁免调用数**：不受限制的初始调用次数

在知识库高级设置中配置这些选项。

## 最佳实践

### 组织文档

1. **将相关文档分组**到同一知识库
2. **使用描述性名称**便于识别
3. **启用摘要**加速文档发现
4. **保持笔记本 KB 专注**（少于 50 个文档）

### 选择 RAG vs 探索模式

| 选择 RAG 当 | 选择探索模式当 |
|-------------|----------------|
| 大型文档集合 | 小型集合（<50 个文档） |
| 需要语义搜索 | 测试时无基础设施 |
| 高查询量 | 避免 Embedding 成本 |
| 复杂的多文档查询 | 简单文档查找 |

### 性能提示

1. **使用混合搜索**获得最佳准确性
2. **根据结果质量调整 Score 阈值**
3. **启用文档摘要**改善探索体验
4. **使用具体查询**而非宽泛查询

## 故障排除

### 文档不显示在搜索中

1. 检查文档是否**已启用**
2. 验证 RAG 索引已完成（检查状态）
3. 尝试降低 **Score 阈值**
4. 使用不同的搜索词

### AI 不使用知识库

1. 验证已选择知识库
2. 检查严格/宽松模式是否合适
3. 审查查询 - 是否与 KB 内容相关？
4. 检查是否已超过调用限制

### 搜索性能慢

1. 考虑减少 **Top K** 值
2. 如果不需要关键词匹配，使用**向量**模式而非**混合**
3. 检查检索器服务健康状态

## 相关文档

- [配置检索器](./configuring-retrievers.md)
- [智能体设置](../settings/agent-settings.md)
- [管理任务](../ai-chat/managing-tasks.md)

---

**注意**：知识库功能正在积极开发中。请查看[更新日志](../../../../README_zh.md)获取更新信息。
